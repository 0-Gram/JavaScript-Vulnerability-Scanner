#/usr/bin/python3
# https://www.xploit.info
import subprocess
import pyfiglet
import importlib


def colored_text(text, color):
    colors = {
        "red": "\033[91m",
        "green": "\033[92m",
        "yellow": "\033[93m",
        "blue": "\033[94m",
        "magenta": "\033[95m",
        "cyan": "\033[96m",
    }
    end_color = "\033[0m"
    return f"{colors[color]}{text}{end_color}"


banner = pyfiglet.figlet_format("www.xploit.info")
print(colored_text(banner, "cyan"))

print("="*40)
print(colored_text("Simple JavaScript Vulnerability Scanner", "yellow"))
print("="*40)

required_modules = ["subprocess", "pyfiglet"]

missing_modules = [module for module in required_modules if not importlib.util.find_spec(module)]

if missing_modules:
    print(colored_text("The following modules are missing:", "red"))
    for module in missing_modules:
        print(f"- {module}")
    
    install_choice = input("Do you want to install the missing modules? (Y/N): ")
    if install_choice.upper() == "Y":
        print("Installing missing modules...")
        subprocess.run(["pip", "install"] + missing_modules, check=True)
        print("Modules installed successfully. You can now run the tool.")
    else:
        print(colored_text("Exiting the tool. Please install the missing modules manually.", "red"))
else:
    site_list = input("\n\nGive me the JavaScript directory: ")

    command = f"cd {site_list}; grep -r -E 'aws_access_key|aws_secret_key|api_key|passwd|pwd|heroku|slack|firebase|swagger|aws_secret_key|aws_key|password|ftp_password|jdbc|apiKey|sql|secret_jet|private_key|admin|pwd|json|gcp|htaccess|.env|ssh_key|.git|access key|secret_token|oauth_token|oauth_token_secret|smtp' *.js --color='auto'"

    result = subprocess.run(command, shell=True)

    if result.returncode == 0:
        print(colored_text("Scan completed successfully.", "green"))
    else:
        print(colored_text("An error occurred during scanning.", "red"))

    print(colored_text("Please visit https://www.xploit.info](https://www.xploit.info/2023/06/looking-for-something-special-in-js.html for more information about this tool and method", "blue"))
